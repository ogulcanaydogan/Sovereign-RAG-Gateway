# Threat Model (Sovereign RAG Gateway)

## Trust Boundaries
1. Client boundary: incoming OpenAI-compatible API traffic.
2. Control boundary: auth, policy, redaction, routing, audit pipeline.
3. Retrieval boundary: connector-backed data access (filesystem/postgres/s3/confluence).
4. Egress boundary: outbound provider requests.

## Primary Threats

| Threat | Failure Mode | Control(s) | Residual Risk |
|---|---|---|---|
| Prompt injection from retrieved content | Unsafe instructions bypass policy intent | Policy-scoped connector authorization, retrieval context controls, deny/transform actions | Model-side instruction following variance remains |
| PHI/PII exfiltration | Sensitive data leaves provider boundary | Classification-aware redaction, fail-closed policy checks, audit evidence with payload hashes | Regex-based redaction has measurable false negatives |
| Cross-tenant data access | Tenant A user retrieves Tenant B source | Mandatory tenant headers, connector allow-list policy checks, retrieval deny path | Misconfigured upstream source ACLs can still leak metadata |
| Policy service outage | Requests continue without governance | `opa_mode=enforce` fail-closed behavior | Availability impact if policy backend unstable |
| Secret compromise | Provider/connector credentials leaked | Secret management, rotation runbook, external secrets support | Runtime process memory exposure not fully eliminated |
| Supply-chain tampering | Untrusted artifacts deployed | Signed release flow, SBOM/provenance generation, CI gates | Dependency zero-day exposure window |
| Cost abuse / denial pressure | 429/5xx storms or budget spikes | Rate limiting, provider fallback, budget-aware routing metrics | Multi-provider correlated outages still possible |

## Control Verification Signals
- Policy decision contract validation (`policy-decision.schema.json`).
- Audit event chain integrity (`prev_hash`, `payload_hash`).
- Redaction telemetry (`redaction_count`, benchmark leakage trend).
- Routing evidence (`provider_attempts`, `fallback_chain`).
- CI gates for schema, tests, benchmark thresholds.

## Incident Replay Inputs
- `request_id`
- audit event row with policy + redaction + provider hashes
- evidence bundle generated by `scripts/audit_replay_bundle.py`
